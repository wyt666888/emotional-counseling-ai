\# API æ–‡æ¡£



\## åŸºç¡€ä¿¡æ¯



\- \*\*Base URL\*\*: `http://localhost:5000/api`

\- \*\*Content-Type\*\*: `application/json`



\## ç«¯ç‚¹



\### 1. å¥åº·æ£€æŸ¥



\*\*GET\*\* `/api/health`



\*\*å“åº”ç¤ºä¾‹\*\*:

```json

{

&nbsp; "status": "ok",

&nbsp; "message": "Emotional Counseling AI is running"

}

```



\### 2. å‘é€æ¶ˆæ¯



\*\*POST\*\* `/api/chat`



\*\*è¯·æ±‚ä½“\*\*:

```json

{

&nbsp; "message": "æˆ‘å’Œç”·æœ‹å‹åµæ¶äº†",

&nbsp; "session\_id": "optional-session-id",

&nbsp; "use\_rag": true  // å¯é€‰ï¼šå¯ç”¨/ç¦ç”¨ RAG

}

```



\*\*å“åº”ç¤ºä¾‹\*\*:

```json

{

&nbsp; "message": "æˆ‘èƒ½ç†è§£ä½ ç°åœ¨çš„å¿ƒæƒ…ğŸ’™...",

&nbsp; "emotion": "sad",

&nbsp; "session\_id": "abc-123",

&nbsp; "rag\_enabled": true

}

```



\### 3. åˆ›å»ºæ–°ä¼šè¯



\*\*POST\*\* `/api/session/new`



\*\*å“åº”ç¤ºä¾‹\*\*:

```json

{

&nbsp; "session\_id": "550e8400-e29b-41d4-a716-446655440000"

}

```



\### 4. åˆ é™¤ä¼šè¯



\*\*DELETE\*\* `/api/session/{session\_id}`



\*\*å“åº”ç¤ºä¾‹\*\*:

```json

{

&nbsp; "message": "ä¼šè¯å·²åˆ é™¤"

}

```



### 5. ç¿»è¯‘æ–‡æœ¬

**POST** `/api/translate`

**è¯·æ±‚ä½“**:
```json
{
  "text": "æˆ‘å¾ˆå¼€å¿ƒ",
  "target_lang": "en",  // å¯é€‰ï¼š'zh-CN' æˆ– 'en'ï¼Œä¸æä¾›åˆ™è‡ªåŠ¨æ£€æµ‹å¹¶ç¿»è¯‘åˆ°ç›¸åè¯­è¨€
  "source_lang": "zh-CN" // å¯é€‰ï¼šæºè¯­è¨€ä»£ç 
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "translated_text": "I'm very happy",
  "source_lang": "zh-CN",
  "target_lang": "en",
  "original_text": "æˆ‘å¾ˆå¼€å¿ƒ"
}
```

**é”™è¯¯å“åº”ç¤ºä¾‹**:
```json
{
  "translated_text": "æˆ‘å¾ˆå¼€å¿ƒ",
  "source_lang": "zh-CN",
  "target_lang": "en",
  "original_text": "æˆ‘å¾ˆå¼€å¿ƒ",
  "error": "Translation service error message"
}
```

### 6. æ£€æµ‹è¯­è¨€

**POST** `/api/translate/detect`

**è¯·æ±‚ä½“**:
```json
{
  "text": "Hello, how are you?"
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "detected_language": "en",
  "text": "Hello, how are you?"
}
```

## ç¿»è¯‘åŠŸèƒ½è¯´æ˜

### æ”¯æŒçš„è¯­è¨€
- **ä¸­æ–‡**: `zh-CN`
- **è‹±æ–‡**: `en`

### è‡ªåŠ¨è¯­è¨€æ£€æµ‹
å½“ä¸æŒ‡å®š `target_lang` æ—¶ï¼Œç³»ç»Ÿä¼šï¼š
1. è‡ªåŠ¨æ£€æµ‹è¾“å…¥æ–‡æœ¬çš„è¯­è¨€
2. å°†å…¶ç¿»è¯‘ä¸ºç›¸åçš„è¯­è¨€ï¼ˆä¸­æ–‡â†’è‹±æ–‡ï¼Œè‹±æ–‡â†’ä¸­æ–‡ï¼‰

### è¯­è¨€æ£€æµ‹åŸç†
ä½¿ç”¨åŸºäºå­—ç¬¦çš„å¯å‘å¼æ–¹æ³•ï¼š
- ç»Ÿè®¡æ–‡æœ¬ä¸­çš„ä¸­æ–‡å­—ç¬¦ï¼ˆCJKç»Ÿä¸€è¡¨æ„æ–‡å­—ï¼‰æ¯”ä¾‹
- å¦‚æœä¸­æ–‡å­—ç¬¦å æ¯”è¶…è¿‡30%ï¼Œåˆ¤å®šä¸ºä¸­æ–‡
- å¦åˆ™åˆ¤å®šä¸ºè‹±æ–‡

### ä½¿ç”¨ç¤ºä¾‹

#### è‡ªåŠ¨æ£€æµ‹å¹¶ç¿»è¯‘
```bash
curl -X POST http://localhost:5000/api/translate \
  -H "Content-Type: application/json" \
  -d '{"text": "ä½ å¥½ï¼Œä¸–ç•Œ"}'
# è‡ªåŠ¨æ£€æµ‹ä¸ºä¸­æ–‡ï¼Œç¿»è¯‘ä¸ºè‹±æ–‡
```

#### æŒ‡å®šç›®æ ‡è¯­è¨€
```bash
curl -X POST http://localhost:5000/api/translate \
  -H "Content-Type: application/json" \
  -d '{"text": "Hello, world", "target_lang": "zh-CN"}'
# ç¿»è¯‘ä¸ºä¸­æ–‡
```

#### ä»…æ£€æµ‹è¯­è¨€
```bash
curl -X POST http://localhost:5000/api/translate/detect \
  -H "Content-Type: application/json" \
  -d '{"text": "ä½ å¥½"}'
```

## RAG (æ£€ç´¢å¢å¼ºç”Ÿæˆ) åŠŸèƒ½

### æ¦‚è¿°

RAG åŠŸèƒ½é€šè¿‡ä»ä¸“ä¸šçŸ¥è¯†åº“æ£€ç´¢ç›¸å…³å†…å®¹æ¥å¢å¼º AI å›å¤çš„è´¨é‡å’Œå‡†ç¡®æ€§ã€‚

### å¯ç”¨/ç¦ç”¨ RAG

#### å…¨å±€é…ç½®ï¼ˆç¯å¢ƒå˜é‡ï¼‰

åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½®ï¼š
```bash
USE_RAG=true                    # å¯ç”¨ RAGï¼ˆé»˜è®¤ï¼‰
RAG_TOP_K=2                     # æ£€ç´¢ç»“æœæ•°é‡
RAG_SIMILARITY_THRESHOLD=0.3    # ç›¸ä¼¼åº¦é˜ˆå€¼
```

#### è¯·æ±‚çº§åˆ«æ§åˆ¶

åœ¨èŠå¤©è¯·æ±‚ä¸­ä½¿ç”¨ `use_rag` å‚æ•°ï¼š

**å¯ç”¨ RAGï¼ˆå¦‚æœé»˜è®¤ç¦ç”¨ï¼‰**:
```bash
curl -X POST http://localhost:5000/api/chat \
  -H "Content-Type: application/json" \
  -d '{
    "message": "æˆ‘å’Œç”·æœ‹å‹åµæ¶äº†",
    "session_id": "test",
    "use_rag": true
  }'
```

**ç¦ç”¨ RAGï¼ˆå¦‚æœé»˜è®¤å¯ç”¨ï¼‰**:
```bash
curl -X POST http://localhost:5000/api/chat \
  -H "Content-Type: application/json" \
  -d '{
    "message": "ä½ å¥½",
    "session_id": "test",
    "use_rag": false
  }'
```

### RAG å“åº”å­—æ®µ

èŠå¤©å“åº”åŒ…å« `rag_enabled` å­—æ®µï¼Œè¡¨ç¤ºè¯¥è¯·æ±‚æ˜¯å¦ä½¿ç”¨äº† RAGï¼š

```json
{
  "message": "AI å›å¤å†…å®¹",
  "emotion": "æƒ…ç»ªæ ‡ç­¾",
  "session_id": "ä¼šè¯ID",
  "rag_enabled": true  // æŒ‡ç¤ºæ˜¯å¦ä½¿ç”¨äº† RAG
}
```

### RAG å·¥ä½œåŸç†

1. **æŸ¥è¯¢å¤„ç†**: æ¥æ”¶ç”¨æˆ·é—®é¢˜
2. **è¯­ä¹‰æ£€ç´¢**: ä»çŸ¥è¯†åº“ä¸­æ£€ç´¢ç›¸å…³å†…å®¹ï¼ˆä½¿ç”¨å‘é‡ç›¸ä¼¼åº¦ï¼‰
3. **ä¸Šä¸‹æ–‡å¢å¼º**: å°†æ£€ç´¢åˆ°çš„çŸ¥è¯†ä¸ç”¨æˆ·é—®é¢˜ç»“åˆ
4. **ç”Ÿæˆå›å¤**: LLM åŸºäºå¢å¼ºçš„ä¸Šä¸‹æ–‡ç”Ÿæˆå›å¤

### é…ç½®å‚æ•°è¯´æ˜

- **USE_RAG**: å…¨å±€å¯ç”¨/ç¦ç”¨ RAG
  - `true`: å¯ç”¨ï¼ˆæ¨èï¼‰
  - `false`: ç¦ç”¨
  
- **RAG_TOP_K**: æ£€ç´¢ç»“æœæ•°é‡
  - èŒƒå›´: 1-5
  - æ¨è: 2
  - æ›´å¤šç»“æœ = æ›´å…¨é¢ä½†å¯èƒ½æ›´æ…¢
  
- **RAG_SIMILARITY_THRESHOLD**: ç›¸ä¼¼åº¦é˜ˆå€¼
  - èŒƒå›´: 0.0-1.0
  - æ¨è: 0.3
  - æ›´é«˜é˜ˆå€¼ = æ›´ç²¾ç¡®ä½†å¯èƒ½æ£€ç´¢ä¸åˆ°ç»“æœ
  - æ›´ä½é˜ˆå€¼ = æ›´å¤šç»“æœä½†ç›¸å…³æ€§å¯èƒ½è¾ƒä½

### ä½¿ç”¨å»ºè®®

1. **ä¸€èˆ¬å’¨è¯¢**: å¯ç”¨ RAGï¼Œè·å¾—ä¸“ä¸šå»ºè®®
2. **é—²èŠå¯¹è¯**: å¯ä»¥ç¦ç”¨ RAGï¼Œæ›´è‡ªç„¶çš„å¯¹è¯
3. **ä¸“ä¸šé—®é¢˜**: å¯ç”¨ RAG å¹¶è®¾ç½®è¾ƒé«˜çš„ top_k å€¼

### æ€§èƒ½å½±å“

- **é¦–æ¬¡è¯·æ±‚**: å¯èƒ½éœ€è¦ 1-2 ç§’ï¼ˆåŠ è½½æ¨¡å‹ï¼‰
- **åç»­è¯·æ±‚**: é€šå¸¸ < 500msï¼ˆä½¿ç”¨ç¼“å­˜ï¼‰
- **ç¦ç”¨ RAG**: å“åº”é€Ÿåº¦æå‡çº¦ 200-300ms

è¯¦ç»†çš„ RAG åŠŸèƒ½æ–‡æ¡£è¯·æŸ¥çœ‹ [RAG_FEATURE.md](RAG_FEATURE.md)

